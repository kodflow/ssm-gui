version: '3'

env:
  ARCHS: "arm64 amd64"
  OS: "darwin linux windows"

tasks:

  ui:
    summary: Build the frontend project
    dir: ui
    cmds:
      - npm run build

  linux:
    summary: Builds the application for Linux
    cmds:
      - task: ui
      - for: { var: ARCHS }
        cmd: GOARCH={{.ITEM}} GOOS=linux go build -gcflags=all="-N -l" -o bin/{{.APP_NAME}}-linux-{{.ITEM}}

  windows:
    summary: Builds the application for Windows
    cmds:
      - task: ui
      - for: { var: ARCHS }
        cmd: GOARCH={{.ITEM}} GOOS=windows go build -gcflags=all="-N -l" -o bin/{{.APP_NAME}}-windows-{{.ITEM}}.exe

  darwin:
    summary: Builds the application
    cmds:
      - task: ui
      - for: { var: ARCHS }
        cmd: GOARCH={{.ITEM}} GOOS=darwin go build -gcflags=all="-N -l" -o bin/{{.APP_NAME}}-darwin-{{.ITEM}}
    env:
      CGO_CFLAGS: "-mmacosx-version-min=10.14"
      CGO_LDFLAGS: "-mmacosx-version-min=10.14"
      MACOSX_DEPLOYMENT_TARGET: "10.14"

  all:
    summary: Builds the application
    cmds:
      - task: darwin
      - task: linux
      - task: windows

  generate-icons:
    summary: Generates Windows `.ico` and Mac `.icns` files from an image
    dir: build
    cmds:
      # Generates both .ico and .icns files
      - wails3 generate icons -input appicon.png